<body>
    <p id = "Header">Saskatchewan Summer Jobs 2019: <br>Organizations that received funding and the number of jobs they created </p>
    <input type = "file" onchange = "openFile(event); document.getElementById('begin').style.display = 'block'" id = "FInput">
    
    <div id = "displayBoard">
        <canvas id = "backgroundCanvas" width ="1420" height = "620"></canvas>
        <canvas id = "MarioCanvas" width ="1420" height = "620"></canvas>
        <canvas id = "displayCanvas" width ="1420" height = "620"></canvas>
        <!--display1 for displaying the entire read data-->
        <div id = "display1">
            <label for = "select">Display Data by</label>
            <select id = "type">
                    <option id = "rawData" value = 1>RawData</option>
                    <option id = "Fields" value = 2>Fields</option>
                    <option id = "Region" value = 3>Regions</option>
                    <option id = "Regional Total" value = 4>Regional Total</option>
                    <option id = "Overall Total" value = 5>Overall Total</option>
                    <option id = "N/A" value = 6>Clear</option>
            </select>
            <input type = "submit" onclick = "displayData()">
            <p id = "inner"></p>
        </div>
        <div id = "display2">
            <label for = "select">Find Data by</label>
            <select id = "fields">
            </select>
            <br>
            <label for "search">Search for:</label>
            <input type = "search" id = "search">
                <input type = "submit" onclick = "checkData()">
            <p id = "inner2"></p>
        </div>
        <div id = "display3">
            <label for = "selectAC">Generate Report From the Following Activity Constituency<br></label>
            <select id = "ACs">
            </select>
            <br>
                <input type = "submit" onclick = "GenerateReport()">
            <p id = "inner3"></p>
        </div>
        <div id = "display4">
            <label for = "select">Graph Data of the following Activity Constituency</label>
            <select id = "options(1)"><br></select>
            <label for = "select">Data Type:</label>
            <select id = "options(2)">
                <option id = "funds" value = 2>Funds</option>
                <option id = "jobs" value = 3>Jobs</option>
            </select>
            <input type = "submit" onclick = "Graph()">
            <div id = "inner4"></div>
            
            <canvas id = "OptionCanvas4" width ="400" height = "400"></canvas>
        </div>
        <div id = "display5">
            
        </div>
    </div>
        <button id = "close1" onclick = 
            "document.getElementById('close1').style.display = 'none';
            document.getElementById('display1').style.display = 'none';
            document.getElementById('display2').style.display = 'none';
            document.getElementById('display3').style.display = 'none';
            document.getElementById('display4').style.display = 'none';
            document.getElementById('display5').style.display = 'none';
            ">
        CLOSE</button>

        <button id = "begin" onclick = " draw(); PlayAudio()">BEGIN</button>
        <button id = "refresh" onclick = "location.reload()">refresh</button>
    </div>
    </table>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@800&display=swap" rel="stylesheet">
    
    <!--images of Marios that contains two poses in two different directions-->
    <image src = "Images/pos1 right.png" id = "MP1R"></image>
    <image src = "Images/pos1 left.png" id = "MP1L"></image>
    <!--images of Background elements-->
    <image src = "Images/Tree.png" style = "display: none;" id = "Tree"></image>
    <image src = "Images/back(2).png" id = "background"></image>
    <!--images of bricks that corresponds to different analysis options-->
    <image src = "Images/Brick(1).png" id = "b1"></image>
    <image src = "Images/Brick(2).png" id = "b2"></image>
    <image src = "Images/Brick(3).png" id = "b3"></image>
    <image src = "Images/Brick(4).png" id = "b4"></image>
    <image src = "Images/Brick(5).png" id = "b5"></image>
    <audio id = "myAudio">
        <source src = "wallpaper-by-kevin-macleod-from-filmmusic-io.mp3" type = "audio/mpeg">
      </audio>
    </body>
<style>
    /*Images{
        display:none;
    }*/
    body{
        background-color: aliceblue;
    }
    #backgroundCanvas{
        position:absolute;
        background-color: white;
        border: 1px solid grey;
    }
    #MarioCanvas{
        position: absolute;
    }
    #displayCanvas{
        position: absolute;
    }
    #display1{
        font-family: 'Orbitron', sans-serif;
        font-size:15px;
        position:absolute;
        display: none;
        width: 600px;
        height: 400px;
        background-color: rgb(216, 216, 216);
        overflow-y: scroll;
    }
    #display2{
        font-family: 'Orbitron', sans-serif;
        font-size:15px;
        position:absolute;
        display: none;
        width: 600px;
        height: 400px;
        background-color: rgb(216, 216, 216);
        overflow-y: scroll;
    }
    #display3{
        font-family: 'Orbitron', sans-serif;
        font-size:25px;
        position:absolute;
        display: none;
        width: 600px;
        height: 400px;
        background-color: rgb(216, 216, 216);
        overflow-y: scroll;
    }
    #display4{
        font-family: 'Orbitron', sans-serif;
        font-size:25px;
        position:absolute;
        display: none;
        width: 850px;
        height: 500px;
        background-color: rgb(247, 247, 247);
        overflow-y: scroll;
    }
    #OptionCanvas4{
        left: 400px;
        position:absolute;
        display: none;
        background-color: white;
        border: 3px solid grey;
    }
    #inner4{
        font-size:12px;
        position: absolute;
        width:350px;
        height: 450px;
        overflow-y: scroll;
        overflow-x: scroll;
    }
    #display5{
        font-family: 'Orbitron', sans-serif;
        font-size:30px;
        position:absolute;
        display: none;
        width: 600px;
        height: 400px;
        background-color: rgb(255, 254, 254);
        overflow-y: scroll;
    }
    img{
        display: none;
    }
    #Header{
        font-family: 'Orbitron', sans-serif;
        font-size: 30px;
    }
    #FInput{
        font-family: 'Orbitron', sans-serif;
        font-size: 20px;
        border-width: 5px;
        border-color: black;
    }
    #begin{
        display: none;
        position: absolute;
        left: 600px;
        top: 400px;
        font-family: 'Orbitron', sans-serif;
        font-size: 30px;
        width: 150px;
        height: 100px;
        border-width: 5px;
        border-color: black;
    }
    #refresh{
        position: absolute;
        left: 1280px;
        top: 30px;
        font-family: 'Orbitron', sans-serif;
        font-size: 30px;
        width: 150px;
        height: 80px;
        border-width: 3px;
        border-color: black;
    }
    #close1{
        display: none;
        position: absolute;
        left: 1280px;
        top: 300px;
        font-family: 'Orbitron', sans-serif;
        font-size: 20px;
        width: 100px;
        height: 60px;
        border-width: 3px;
        border-color: black;
    }

</style>

<script>        
    //Note: Please store all source images into a new local file "Images" otherwise nothing can be displayed on canvas
    //variables for data analysis
    var data //data result from the openFile() function
    var fields // fields of the data (the 1st line)
    var rawData = []; //data splited into 2-dimensional array
    var sumData = []; //data that only contains total stats
    var SaskSum = []; //data that sums up all stats
    var fieldData = []; // rawData analyzed according to fields
    var regionData = [] // rawData analyzed according to regions


    //variables for Animated Data Report
    var backCVS = document.getElementById("backgroundCanvas")
    var cvs = document.getElementById("MarioCanvas")
    var cvs1 = document.getElementById("displayCanvas")
    var OptionCVS1 = document.getElementById("OptionCanvas4")
    //var OptionCVS1 = document.getElementById("OptionCanvas5")
    
    var xData = 550
    var Alpha = 0.1//opacity of graphs

    //variables for Audioes
    var aud = document.getElementById("myAudio")

    //variables for controlling Mario
    document.addEventListener("keydown", keyDownHandler, false);
    document.addEventListener("keyup", keyUpHandler, false);
    var keyCondition = true
    var BrickReach = false
    var jumpPressed = false
    var leftPressed = false
    var rightPressed = false
    var LR = true

    //openFile functions
    function openFile(event){
        document.getElementById("FInput").style.display = "none"
        var fileInput = event.target;
        var r = new FileReader();
        r.readAsText(fileInput.files[0]); //reads the first file selected
        r.onload = function(){
            data = r.result.split("\n")
            analyzeData()
            var Jobs1 = sortJobs(regionData[0],0)

            //add options to display in option 2
            var c = document.getElementById("fields");
            for (var counter = 0; counter < fields.length; counter++){
                var option = document.createElement("option");
                option.text = fields[counter];
                option.value = counter;
                c.add(option);
            }
            document.getElementById("inner2").innerHTML = rawData.join("<br><br>")

            //add options to display in option 3
            var a = document.getElementById("ACs")
            for (var counter = 0; counter < sumData.length; counter++){
                var option = document.createElement("option")
                option.text = sumData[counter][0]
                option.value = counter
                a.add(option)
            }

            //add options to display in option 4
            var c = document.getElementById("options(1)")
            for (var counter = 0; counter < sumData.length; counter++){
                var option = document.createElement("option")
                option.text = sumData[counter][0]
                option.value = counter
                c.add(option)
            }
        }
    }

    //list of functions that sort the data
    function analyzeData(){
        fields = data.shift().split(",")
        for(var counter = 0; counter < data.length; counter++){
            rawData.push(data[counter].split(","))
        }//split the data into a 2-dimensional array
        rawData.pop()
        SaskSum = rawData.pop()
        
        for(var counter = 0; counter < rawData.length; counter++){//currency to numbers
            if(rawData[counter].length == 6){//check if there's additional commas that makes the array's length even greater
                JoinData2(rawData[counter])//execute the function to get rid of exessive commas
            }
            else if(rawData[counter].length == 7){//check if there's additional commas in number (more than 1,000,000)
                JoinData3(rawData[counter])//execute the function to get rid of exessive commas
            }
            rawData[counter] = JoinData(rawData[counter])//execute the function to convert the currency strings into numbers
        }
        for(var countF = 0; countF < fields.length; countF++){//resort the data according to fields
            var pushArray = []
            for(var countD = 0; countD < rawData.length; countD++){
                pushArray.push(rawData[countD][countF])
            }
            fieldData.push(pushArray)
        }
        for(var countF = 0; countF < rawData.length;countF++){//push sum data into the array
            if(fieldData[2][countF]>200000){
                sumData.push(rawData[countF])
                rawData.splice(countF,1)
                for(var countR = 0; countR < fieldData.length; countR++){
                    fieldData[countR].splice(countF,1)
                }
            }
        }
        for (var countR = 0; countR < sumData.length; countR++){
            var pushArray = []
            for(var counter = 0; counter < fieldData[0].length; counter++){
                if(sumData[countR][0] == fieldData[0][counter]){
                    pushArray.push(rawData[counter])
                }
            }
            regionData.push(pushArray)
        }
        GenerateFinalReport()
    }
    function JoinData(array){
        var joinedNum = array[2]+array[3]
        joinedNum = String(joinedNum)
        joinedNum = joinedNum.split("")
        joinedNum.shift()
        joinedNum.shift()
        joinedNum.pop()
        array.splice(2,2,Number(joinedNum.join("")))
        return array
    }
    function JoinData2(array){
        var joinedNum = array[1] + array[2]
        joinedNum = String(joinedNum)
        array.splice(1,2,joinedNum)
        return array
    }
    function JoinData3(array){
        var joinedNum = array[1]+array[2]+array[3]
        joinedNum = String(joinedNum)
        array.splice(1,3,joinedNum)
        return array
    }
    
    //data analysis option 1
    function displayData(){
        var c = document.getElementById("type")
        var n = c.options[c.selectedIndex].value
        if (n == 1){
            document.getElementById("inner").innerHTML = rawData.join("<br><br>");
        }
        else if (n == 2){
            document.getElementById("inner").innerHTML = fieldData.join("<br><br>");
        }
        else if (n == 3){
            document.getElementById("inner").innerHTML = regionData.join("<br><br>");
        }
        else if (n == 4){
            document.getElementById("inner").innerHTML = sumData.join("<br><br>");
        }
        else if (n == 5){
            document.getElementById("inner").innerHTML = SaskSum;
        }
        else if (n == 6){
            document.getElementById("inner").innerHTML = "";
        }
    }
    //data analysis option 2
    function checkData(){
        var c = document.getElementById("fields")
        //var selectInput = c.options[c.selectedIndex].text
        var fieldNumber = c.options[c.selectedIndex].value
        var linesLength = rawData.length
        var s = document.getElementById("search")
        var searchInput = s.value
        var output = []
        for (var dataC = 0; dataC < linesLength; dataC++){
            if (searchInput == fieldData[fieldNumber][dataC]){
                output.push(rawData[dataC])
            }
        }
        document.getElementById("inner2").innerHTML = output.join("<br><br>"); //displays text   
    }
    //data analysis option 3
    function GenerateReport(){
        var c = document.getElementById("ACs")
        var ACNum = c.options[c.selectedIndex].value
        document.getElementById("inner3").innerHTML = 
            "In " + sumData[ACNum][0] + ":<br>$" + sumData[ACNum][2] + 
            " was given as funds<br>" + sumData[ACNum][3] + " jobs were created; <br> There were " + 
            regionData[ACNum].length + " organizations involved throughout the summer in 2019"
    }
    //data analysis option 4
    function Graph(){
        requestAnimationFrame(Graph)
        var a = document.getElementById("options(1)")
        var ACNum = a.options[a.selectedIndex].value
        var b = document.getElementById("options(2)")
        var OptionNum = b.options[b.selectedIndex].value
        var Input
        var unit
        if(OptionNum == 2){
            Input = sortFunds(regionData[ACNum])
            unit = "($)"
        }
        else if (OptionNum == 3){
            Input = sortJobs(regionData[ACNum])
        }
        var PIE = new GeneralDisplay(OptionCVS1)
        PIE.clear()
        PIE.pieDraw(Input)
        PIE.ctx.fillStyle = "black"
        PIE.ctx.font = "16px sans serif"
        PIE.ctx.fillText(fields[OptionNum] + " of " + sumData[ACNum][0] + unit,0,20)
        document.getElementById("inner4").innerHTML = "<br>The Selected Array displays as:<br>" + regionData[ACNum].join("<br>")
    }
    //data analysis option 5
    function GenerateFinalReport(){
        var totalJobs = SaskSum[SaskSum.length-2]+SaskSum[SaskSum.length-1]
        var totalFund = SaskSum[2]+SaskSum[3]+SaskSum[4]
        document.getElementById("display5").innerHTML = 
            "OVERALL:<br>" + totalFund + 
            " was given as funds to " + rawData.length + " organizations belonging to " + sumData.length + 
            " different Activity Constituencies.<br><br> This Led to " + 
            totalJobs + " Jobs introduced among Saskatchewan throughout the summer in 2019."
    }
    
    var Images = {
        trees: document.getElementById("Tree"),
        Mario1: document.getElementById("MP1R"),
        Mario2: document.getElementById("MP1L"),
        background: document.getElementById("background"),
        bck1: document.getElementById("b1"),
        bck2: document.getElementById("b2"),
        bck3: document.getElementById("b3"),
        bck4: document.getElementById("b4"),
        bck5: document.getElementById("b5"),
    }
    function sortJobs(array){ // resort Jobs according to ranges of data
        var total = array.length;
        var P1 = 0;
        var P2 = 0;
        var P3 = 0;
        var P4 = 0;
        for(var count1 = 0; count1 < array.length; count1++){
            var x = Number(array[count1][3])
            if(x <= 3){
                P1 += 1
            }
            else if (x > 3 && x <= 6){
                P2 += 1
            }
            else if (x > 6 && x <= 10){
                P3 += 1
            }
            else{
                P4 += 1
            }
        }
        const results = [
        {range: "1-3", angle: P1/total, shade: "#e60000"},
        {range: "4-6", angle: P2/total, shade: "#b30000"},
        {range: "7-10", angle: P3/total, shade: "#800000"},
        {range: "More", angle: P4/total, shade: "#000000"}
        ]
        return results
    }
    function sortFunds(array){ // resort Funds according to ranges of data
        var total = array.length;
        var P1 = 0;
        var P2 = 0;
        var P3 = 0;
        var P4 = 0;
        for(var count1 = 0; count1 < array.length; count1++){
            var x = Number(array[count1][2])
            if(x <= 5000){
                P1 += 1
            }
            else if (x > 5000 && x <= 10000){
                P2 += 1
            }
            else if (x > 10000 && x <= 15000){
                P3 += 1
            }
            else{
                P4 += 1
            }
        }
        const results = [
        {range: "below 5000", angle: P1/total, shade: "#58CCED"},
        {range: "5000-10000", angle: P2/total, shade: "#3895D3"},
        {range: "10000-15000", angle: P3/total, shade: "#1261A0"},
        {range: "Above 15000", angle: P4/total, shade: "#072F5F"}
        ]
        return results
    }
    function background(canvas){
        this.canvas = canvas
        this.ctx = this.canvas.getContext("2d")
        this.draw = ()=>{
            this.ctx.drawImage(Images.background,0,0,1420,620)
            this.ctx.drawImage(Images.trees,10,190,400,400)
            this.ctx.drawImage(Images.trees,1100,190,400,400)
        }

    }
    function GeneralDisplay(canvas){
        this.canvas = canvas;
        this.ctx = this.canvas.getContext("2d");
        this.pieDraw = (input) => {
            this.ctx.fillStyle = "red"
            this.ctx.strokeStyle = "black"
            this.ctx.globalAlpha = Alpha
            this.currentAngle = 0;
            this.currentWordy = 300
            
            for (var portion of input){// draw the pies
                this.portionAngle = portion.angle*2*Math.PI
                this.ctx.beginPath();
                this.ctx.arc(200, 150, 100, this.currentAngle, this.currentAngle + this.portionAngle);
                this.currentAngle += this.portionAngle;
                this.ctx.lineTo(200, 150);
                //filling the slices with the corresponding mood's color
                this.ctx.fillStyle = portion.shade;
                this.ctx.fill();
                this.ctx.font = "20px sans serif";
                this.percentage = (portion.angle*100).toFixed(2)
                this.ctx.fillText(portion.range + ": " + this.percentage +"%", 10, this.currentWordy)
                this.currentWordy += 20
                Alpha+=0.001
            }
        }
        
        this.displayBricks = () =>{
            this.ctx.font = "15px Orbitron";
            this.ctx.drawImage(Images.bck1,xData - 370,180,150,150)
            this.ctx.drawImage(Images.bck2,xData - 170,180,150,150)
            this.ctx.drawImage(Images.bck3,xData + 30,180,150,150)
            this.ctx.drawImage(Images.bck4,xData + 230,180,150,150)
            this.ctx.drawImage(Images.bck5,xData + 430,180,150,150)

            this.ctx.drawImage(Images.bck1,xData+530,20,50,50)
            this.ctx.fillText("List of Data",xData+580,50)
            this.ctx.drawImage(Images.bck2,xData+530,50,50,50)
            this.ctx.fillText("Search?",xData+580,80)
            this.ctx.drawImage(Images.bck3,xData+530,80,50,50)
            this.ctx.fillText("Activity Constituency Report",xData+580,110)
            this.ctx.drawImage(Images.bck4,xData+530,110,50,50)
            this.ctx.fillText("Activity Constituency Pie Charts",xData+580,140)
            this.ctx.drawImage(Images.bck5,xData+530,140,50,50)
            this.ctx.fillText("Total Data Report",xData+580,170)
        }
        
        this.clear = () =>{
            this.ctx.clearRect(0,0,1420,620)
        }
    }
    var general1 = new GeneralDisplay(cvs1)
    var Back = new background(backCVS)
    var Mario = new Mario(cvs)
    
    function keyDownHandler(e) {
        if (keyCondition == true){
          if(e.key == "Up" || e.key == "ArrowUp"){
            jumpPressed = true;
          }
          else if(e.key == "Left" || e.key == "ArrowLeft") {
            leftPressed = true;
          }
          else if(e.key == "Right" || e.key == "ArrowRight"){
            rightPressed = true;
          }
        }
      }   
    function keyUpHandler(e) {
        if (keyCondition == true){
          if(e.key == "Up" || e.key == "ArrowUp") {
            jumpPressed = false;
          }
          else if(e.key == "Left" || e.key == "ArrowLeft") {
            leftPressed = false;
          }
          else if(e.key == "Right" || e.key == "ArrowRight"){
            rightPressed = false;
          }
        } 
      }
    function Mario(canvas){
        this.canvas = canvas;
        this.ctx = this.canvas.getContext("2d")
        this.xMario = 550;
        this.yMario = 320;
        this.fallV = 0;
        this.jumpV = 15;
        this.brickStand = true
        this.displayMario = () =>{
            if (LR == false){//pointing left
                this.ctx.drawImage(Images.Mario2,this.xMario,this.yMario,200,200)
            }
            else if (LR == true){//pointing left
                this.ctx.drawImage(Images.Mario1,this.xMario,this.yMario,200,200)
            }
        }
        
        this.userControl = ()=>{
            //control jump & fall
            if (jumpPressed == true && this.brickStand == true){
                if (this.yMario > 150){
                    this.yMario -= this.jumpV
                    if (this.jumpV > 0){
                        this.jumpV -= 1
                        this.fallV = 0
                    }
                }
                else if (this.yMario <= 150){
                    this.jumpV = 0
                    this.yMario = 150
                    this.brickStand = false
                }
            }
            //control moving left & right
            if ((jumpPressed == false && this.yMario < 320) || (this.jumpV == 0 && this.yMario < 320)){
                this.yMario += this.fallV
                if (this.fallV < 10){
                    this.fallV += 2
                }
                    
            }
            if(this.yMario >= 320 && jumpPressed == false){
                this.jumpV = 15
                this.brickStand = true
            }
            if (rightPressed == true){
                LR = true
                if (this.xMario <= 1220){
                    this.xMario += 5
                }
            }
            if (leftPressed == true){
                LR = false
                if (this.xMario >= 0){
                    this.xMario -= 5
                }   
            }
        }
        this.collisionDetection = () =>{
            if(this.xMario > xData - 420 && this.xMario < xData - 270 && this.yMario < 250){
                document.getElementById("display1").style.display = "block";
                document.getElementById("close1").style.display = "block"
                
            }
            if(this.xMario > xData - 220 && this.xMario < xData - 70 && this.yMario < 250){
                document.getElementById("display2").style.display = "block";
                document.getElementById("close1").style.display = "block"

            }
            if(this.xMario > xData - 20 && this.xMario < xData + 130 && this.yMario < 250){
                document.getElementById("display3").style.display = "block";
                document.getElementById("close1").style.display = "block"
            }
            if(this.xMario > xData + 180 && this.xMario < xData + 330 && this.yMario < 250){
                document.getElementById("display4").style.display = "block";
                document.getElementById("OptionCanvas4").style.display = "block";
                document.getElementById("close1").style.display = "block"
            }
            if(this.xMario > xData + 380 && this.xMario < xData + 550 && this.yMario < 250){
                document.getElementById("display5").style.display = "block";
                document.getElementById("close1").style.display = "block"
            }
        }
        this.clear = () =>{
            this.ctx.clearRect(0,0,1420,620)
        }    
    }

    function PlayAudio(){
      aud.play()
      aud.loop = true
    }
    function draw(){
        document.getElementById("begin").style.display = "none"
        general1.clear()
        Mario.clear()
        var Jobs1 = sortJobs(regionData[0])
        Back.draw()

        Mario.displayMario()
        Mario.collisionDetection()
        Mario.userControl()
        general1.displayBricks()
        
        requestAnimationFrame(draw)
    }
    






</script>